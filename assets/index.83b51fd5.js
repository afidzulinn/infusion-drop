var $=Object.defineProperty;var J=(r,o,a)=>o in r?$(r,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[o]=a;var R=(r,o,a)=>(J(r,typeof o!="symbol"?o+"":o,a),a);import{r as l,a as V}from"./react.6a6e1531.js";import{c as G}from"./react-dom.7ac3fd10.js";import{e as P,t as A,s as M,d as L,c as H,a as j,i as W,b as N,f as K,r as Z,l as _,o as Q}from"./@tensorflow.706f68fb.js";import{N as T,B as X}from"./react-router-dom.12ebcaa1.js";import{i as Y,g as ee,s as te,c as oe,o as se}from"./@firebase.026f7ad6.js";import"./firebase.52c5b8a5.js";import{e as p,j as t,F as O,d as D,f as re,g as k,h as ne}from"./react-router.dfd56c0c.js";import{C as ae}from"./react-circular-progressbar.d1cc9ac8.js";import"./long.fedf71ce.js";import"./scheduler.a4ffa0e8.js";import"./seedrandom.aa722f37.js";import"./@remix-run.ec8d0b68.js";import"./tslib.3c1e63d7.js";import"./idb.13e98345.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const e of s)if(e.type==="childList")for(const n of e.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function a(s){const e={};return s.integrity&&(e.integrity=s.integrity),s.referrerpolicy&&(e.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?e.credentials="include":s.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function i(s){if(s.ep)return;s.ep=!0;const e=a(s);fetch(s.href,e)}})();const ie={apiKey:"AIzaSyCJF1bAiWVTsGzZEJZk2ru8BJMuxNaWyAU",authDomain:"infusion-webapp-auth.firebaseapp.com",projectId:"infusion-webapp-auth",storageBucket:"infusion-webapp-auth.appspot.com",messagingSenderId:"30572949639",appId:"1:30572949639:web:d157d4416b2af6fda28822",measurementId:"G-LCPJEFLHB4"},le=Y(ie),E=ee(le);const z=r=>p("div",{className:"wrapper",...r,children:[t("div",{className:"spinner"}),t("p",{children:r.children})]});class ce{constructor(){R(this,"open",o=>{navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then(a=>{o.srcObject=a}):alert("Can't open Webcam!")});R(this,"close",o=>{o.srcObject?(o.srcObject.getTracks().forEach(a=>{a.stop()}),o.srcObject=null):alert("Please open Webcam first!")})}}const q=["drop"],de=(r,o,a,i,s)=>{const e=r.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height);const n=new B,d=`${Math.max(Math.round(Math.max(e.canvas.width,e.canvas.height)/40),14)}px Arial`;e.font=d,e.textBaseline="top";for(let c=0;c<a.length;++c){const m=q[i[c]],h=n.get(i[c]),x=(a[c]*100).toFixed(1);let[f,y,w,b]=o.slice(c*4,(c+1)*4);y*=s[0],b*=s[0],f*=s[1],w*=s[1];const S=b-y,v=w-f;e.fillStyle=B.hexToRgba(h,.2),e.fillRect(y,f,S,v),e.strokeStyle=h,e.lineWidth=Math.max(Math.min(e.canvas.width,e.canvas.height)/200,2.5),e.strokeRect(y,f,S,v),e.fillStyle=h;const C=e.measureText(m+" - "+x+"%").width,u=parseInt(d,10),g=f-(u+e.lineWidth);e.fillRect(y-1,g<0?0:g,C+e.lineWidth,u+e.lineWidth),e.fillStyle="#ffffff",e.fillText(m+" - "+x+"%",y-1,g<0?0:g)}};class B{constructor(){R(this,"get",o=>this.palette[Math.floor(o)%this.n]);this.palette=["#FF3838","#FF9D97","#FF701F","#FFB21D","#CFD231","#48F90A","#92CC17","#3DDB86","#1A9334","#00D4BB","#2C99A8","#00C2FF","#344593","#6473FF","#0018EC","#8438FF","#520085","#CB38FF","#FF95C8","#FF37C7"],this.n=this.palette.length}}R(B,"hexToRgba",(o,a)=>{var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(o);return i?`rgba(${[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)].join(", ")}, ${a})`:null});const ue=q.length,pe=(r,o,a)=>{let i,s;return[A(()=>{const n=K(r),[d,c]=n.shape.slice(0,2),m=Math.max(c,d),h=n.pad([[0,m-d],[0,m-c],[0,0]]);return i=m/c,s=m/d,W.resizeBilinear(h,[o,a]).div(255).expandDims(0)}),i,s]},me=async(r,o,a,i,s=()=>{})=>{const[e,n]=o.inputShape.slice(1,3);P().startScope();const[d,c,m]=pe(r,e,n),h=o.net.execute(d),x=h.transpose([0,2,1]),f=A(()=>{const u=x.slice([0,0,2],[-1,-1,1]),g=x.slice([0,0,3],[-1,-1,1]),F=M(x.slice([0,0,0],[-1,-1,1]),L(u,2)),I=M(x.slice([0,0,1],[-1,-1,1]),L(g,2));return H([I,F,j(I,g),j(F,u)],2).squeeze()}),[y,w]=A(()=>{const u=x.slice([0,0,4],[-1,-1,ue]).squeeze(0);return[u.max(1),u.argMax(1)]}),b=await W.nonMaxSuppressionAsync(f,y,500,.45,.2),S=f.gather(b,0).dataSync(),v=y.gather(b,0).dataSync(),C=w.gather(b,0).dataSync();de(a,S,v,C,[c,m]),N([h,x,f,y,w,b]),s(),v!=null&&v[0]?i(!0):i(!1),P().endScope()},he=(r,o,a,i)=>{const s=async()=>{if(r.videoWidth===0&&r.srcObject===null){const e=a.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height);return}me(r,o,a,i,()=>{requestAnimationFrame(s)})};s()};const ge=({value:r})=>t(O,{children:t("div",{style:{width:"100vw",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3,top:0,position:"absolute",marginTop:"16px"},children:t("div",{style:{width:150,height:150},children:t(ae,{value:r,styles:{color:"#0000"},minValue:0,maxValue:60,text:r})})})}),fe=({imageRef:r,cameraRef:o,videoRef:a,setPlay:i,timer:s})=>{const[e,n]=l.exports.useState(null),d=l.exports.useRef(null);l.exports.useRef(null);const c=new ce,m=()=>{const h=r.current.src;r.current.src="#",URL.revokeObjectURL(h),n(null),d.current.value="",r.current.style.display="none"};return l.exports.useEffect(()=>{s===0&&(o.current.style.display="none"),n(null)},[s]),p("button",{style:{width:"100%"},onClick:()=>{e===null||e==="image"?(e==="image"&&m(),c.open(o.current),o.current.style.display="block",n("camera")):e==="camera"&&s===0?(c.close(o.current),o.current.style.display="none",n(null)):alert(`Can't handle more than 1 stream
Currently streaming : ${e}`),i(h=>!h)},children:[e==="camera"?"Close":"Open"," Webcam"]})},ye=()=>{const r=D(),[o,a]=l.exports.useState(""),[i,s]=l.exports.useState("");return l.exports.useEffect(()=>{const n=localStorage.getItem("token");console.log(n),n&&r("/")},[]),t(O,{children:t("main",{children:t("section",{style:{backgroundColor:"#000",display:"flex",justifyContent:"center",alignItems:"center",width:"100vw",height:"100vh"},children:p("div",{style:{backgroundColor:"#fff",padding:"2rem",borderRadius:"0.5rem",boxShadow:"0 0 1rem rgba(255, 255, 255, 0.1)"},children:[t("h1",{style:{color:"#000",textAlign:"center",marginBottom:"2rem"},children:"Please login to your account"}),p("form",{children:[p("div",{style:{marginBottom:"1rem"},children:[t("label",{htmlFor:"email-address",style:{color:"#000",display:"block",marginBottom:"0.5rem"},children:"Email address"}),t("input",{id:"email-address",name:"email",type:"email",required:!0,placeholder:"Email address",onChange:n=>a(n.target.value),style:{width:"100%",padding:"0.5rem",borderRadius:"0.25rem",border:"1px solid #ccc"}})]}),p("div",{style:{marginBottom:"1rem"},children:[t("label",{htmlFor:"password",style:{color:"#000",display:"block",marginBottom:"0.5rem"},children:"Password"}),t("input",{id:"password",name:"password",type:"password",required:!0,placeholder:"Password",onChange:n=>s(n.target.value),style:{width:"100%",padding:"0.5rem",borderRadius:"0.25rem",border:"1px solid #ccc"}})]}),t("div",{style:{textAlign:"center"},children:t("button",{onClick:n=>{n.preventDefault(),te(E,o,i).then(d=>{const c=d.user;console.log(d),localStorage.setItem("token",d._tokenResponse.idToken),r("/"),console.log(c)}).catch(d=>{const c=d.code,m=d.message;console.log(c,m)})},style:{backgroundColor:"#000",color:"#fff",padding:"0.5rem 1rem",borderRadius:"0.25rem",border:"none",cursor:"pointer"},children:"Login"})})]}),p("p",{className:"text-sm text-white text-center",style:{color:"#000",textAlign:"center",marginTop:"1rem"},children:["No account yet? "," ",t(T,{to:"/signup",style:{color:"#000",textDecoration:"underline"},children:"Sign up"})]})]})})})})},xe=()=>{const r=D(),[o,a]=l.exports.useState(""),[i,s]=l.exports.useState("");return t("main",{children:t("section",{style:{backgroundColor:"#000",display:"flex",justifyContent:"center",alignItems:"center",width:"100vw",height:"100vh"},children:t("div",{style:{backgroundColor:"#fff",padding:"2rem",borderRadius:"0.5rem",boxShadow:"0 0 1rem rgba(255, 255, 255, 0.1)"},children:p("div",{children:[t("h1",{style:{color:"#000",textAlign:"center",marginBottom:"2rem"},children:"SignUp"}),p("form",{onSubmit:async n=>{n.preventDefault();try{await oe(E,o,i),r("/login")}catch(d){const c=d.code,m=d.message;console.log(c,m)}},children:[p("div",{style:{marginBottom:"1rem"},children:[t("label",{htmlFor:"email-address",style:{color:"#000",display:"block",marginBottom:"0.5rem"},children:"Email address"}),t("input",{type:"email",label:"Email address",value:o,onChange:n=>a(n.target.value),required:!0,placeholder:"Email address",style:{width:"100%",padding:"0.5rem",borderRadius:"0.25rem",border:"1px solid #ccc"}})]}),p("div",{style:{marginBottom:"1rem"},children:[t("label",{htmlFor:"password",style:{color:"#000",display:"block",marginBottom:"0.5rem"},children:"Password"}),t("input",{type:"password",label:"Create password",value:i,onChange:n=>s(n.target.value),required:!0,placeholder:"Password",style:{width:"100%",padding:"0.5rem",borderRadius:"0.25rem",border:"1px solid #ccc"}})]}),t("div",{style:{textAlign:"center"},children:t("button",{type:"submit",style:{backgroundColor:"#000",color:"#fff",padding:"0.5rem 1rem",borderRadius:"0.25rem",border:"none",cursor:"pointer"},children:"Sign up"})})]}),p("p",{style:{color:"#000",textAlign:"center",marginTop:"1rem"},children:["Already have an account?"," ",t(T,{to:"/login",style:{color:"#000",textDecoration:"underline"},children:"Sign in"})]})]})})})})},be=({children:r})=>{const[o,a]=l.exports.useState(null),[i,s]=l.exports.useState(!0);return l.exports.useEffect(()=>{const e=se(E,n=>{a(n),s(!1)});return()=>e()},[]),i?t(z,{children:"Loading..."}):o?r:t(ne,{to:"/login"})},ve=()=>{const[r,o]=l.exports.useState({loading:!0,progress:0}),[a,i]=l.exports.useState(!1),[s,e]=l.exports.useState({net:null,inputShape:[1,0,0,3]}),[n,d]=l.exports.useState(0),c=D(),m=l.exports.useRef(null),h=l.exports.useRef(null),x=l.exports.useRef(null),f=l.exports.useRef(null),y="fix";l.exports.useEffect(()=>{const u=localStorage.getItem("token");console.log(u),u==null&&c("/login"),Z().then(async()=>{const g=await _(`${window.location.href}/${y}_web_model/model.json`,{onProgress:U=>{o({loading:!0,progress:U})}}),F=Q(g.inputs[0].shape),I=g.execute(F);o({loading:!1,progress:1}),e({net:g,inputShape:g.inputs[0].shape}),N([I,F])})},[]);const w=u=>{i(u)};l.exports.useEffect(()=>{a&&d(u=>u+1)},[a]);const[b,S]=l.exports.useState(60),[v,C]=l.exports.useState(!1);return l.exports.useEffect(()=>{let u=null;return v&&(u=setInterval(()=>{S(g=>g===0?(C(!1),clearInterval(u),60):g-1)},1e3)),()=>{S(60),clearInterval(u)}},[v]),r.loading?p(z,{children:["Loading model... ",(r.progress*100).toFixed(2),"%"]}):p("div",{style:{width:"100vw",height:"100vh",padding:0,margin:0},children:[p("div",{className:"content",children:[t("video",{autoPlay:!0,muted:!0,ref:h,onPlay:()=>he(h.current,s,f.current,w)}),t("canvas",{width:s.inputShape[1],height:s.inputShape[2],ref:f})]}),t(ge,{value:b,drop:n}),t("div",{style:{width:"100vw",position:"absolute",top:"20px"},children:t("h3",{})}),p("div",{style:{width:"100vw",display:"flex",flexDirection:"column",position:"absolute",bottom:0,zIndex:3,justifyContent:"center"},children:[t("div",{className:"status",style:{marginBottom:"8px",width:"80%",alignSelf:"center"},children:p("h3",{style:{textAlign:"center",margin:"4px, 0"},children:["Drop Stats in one minutes : ",n]})}),t(fe,{imageRef:m,cameraRef:h,videoRef:x,setPlay:C,timer:b})]})]})},we=()=>t(X,{children:p(re,{children:[t(k,{path:"/login",element:t(ye,{})}),t(k,{path:"/signup",element:t(xe,{})}),t(k,{path:"/",element:t(be,{children:t(ve,{})})})]})});const Se=G(document.getElementById("root"));Se.render(t(V.StrictMode,{children:t(we,{})}));
